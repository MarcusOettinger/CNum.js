function CNum(expr){var _margin=50;var X_C=100;var Y_C=100;var _plotW;var _plotH;var _SCALE=10;var _maxradius=1;var _tickLength=3;var _daCanvas=null;var _count=0;var _TICKSCALE=0.001;var _defaults={clear:false,coords:false,Arrow:true,circle:false,ReIm:true,Ctext:true,arc:true,color:"#888",colarrow:false};zStr=math.eval(expr);this.zNum=math.complex(zStr);this.x=math.round(this.zNum.re,3);this.y=math.round(this.zNum.im,3);var _radius=this.zNum.toPolar().r;var _a=this.zNum.toPolar().phi;this.angle=_a<0?2*Math.PI+_a:_a;function _XScaled(x){return _SCALE*x}function _YScaled(y){return _SCALE*y}function _XPos(x){return X_C+_XScaled(x)}function _YPos(y){return Y_C-_YScaled(y)}function sign(x){return typeof x==="number"?x?x<0?-1:1:x===x?0:NaN:NaN}function getmax(v1,v2,v3){m=v1>v2?v1:v2;return v3>m?v3:m}function min(a,b){if(b<a){return b}return a}function max(a,b){if(b>a){return b}return a}function setScale(maxradius){X_C=_daCanvas.width()/2;Y_C=_daCanvas.height()/2;_plotW=_daCanvas.width()-2*_margin;_plotH=_daCanvas.height()-2*_margin;_SCALE=min(_plotW,_plotH)/(2*maxradius);_maxradius=maxradius;while(maxradius/_TICKSCALE>10){_TICKSCALE=_TICKSCALE*10}if(_TICKSCALE>10){_TICKSCALE=_TICKSCALE*2}}function drawticks(pos){_daCanvas.drawLine({strokeStyle:"#000",strokeWidth:2,rounded:false,endArrow:false,x1:_XPos(pos),y1:Y_C,x2:_XPos(pos),y2:Y_C+_tickLength});_daCanvas.drawText({strokeStyle:"#000",strokeWidth:1,x:_XPos(pos),y:Y_C+10,fontSize:10,fontFamily:"serif",text:pos});_daCanvas.drawLine({strokeStyle:"#000",strokeWidth:2,rounded:false,endArrow:false,x1:X_C,y1:_YPos(pos),x2:X_C-_tickLength,y2:_YPos(pos)});_daCanvas.drawText({strokeStyle:"#000",strokeWidth:1,x:X_C-20,y:_YPos(pos)+3,fontSize:10,fontFamily:"serif",text:pos})}function axis(){if(_daCanvas==null){return}_daCanvas.drawLine({strokeStyle:"#000",strokeWidth:2,rounded:false,endArrow:true,arrowRadius:10,arrowAngle:90,x1:_margin,y1:Y_C,x2:_plotW+_margin,y2:Y_C});_daCanvas.drawLine({strokeStyle:"#000",strokeWidth:2,rounded:false,endArrow:true,arrowRadius:10,arrowAngle:90,x1:X_C,y1:_plotH+_margin,x2:X_C,y2:_margin});for(i=_TICKSCALE;i<=_maxradius;i+=_TICKSCALE){drawticks(i)}}function drawReIm(x,y,style){xpos=_XPos(x);ypos=_YPos(y);_daCanvas.drawLine({strokeStyle:style,strokeWidth:1,x1:xpos,y1:Y_C,x2:xpos,y2:ypos});_daCanvas.drawLine({strokeStyle:style,strokeWidth:1,x1:X_C,y1:ypos,x2:xpos,y2:ypos})}function drawz(z,settings,xstart,ystart){xpos=_XPos(z.x);ypos=_YPos(z.y);x=_XScaled(xstart);y=_YScaled(ystart);style=settings.colarrow?settings.color:"#000";if(settings.Arrow){_daCanvas.drawLine({strokeStyle:style,strokeWidth:2,rounded:false,endArrow:true,arrowRadius:10,arrowAngle:45,x1:X_C+x,y1:Y_C-y,x2:xpos+x,y2:ypos-y})}else{_daCanvas.drawRect({strokeStyle:style,strokeWidth:2,fromCenter:true,x:xpos,y:ypos,width:5,height:5})}if(settings.Ctext){_daCanvas.drawText({strokeStyle:style,strokeWidth:1,x:xpos+x+10,y:ypos-(sign(z.y)*10)-y,fontSize:12,fontFamily:"serif",text:"z ="+math.complex(z.x,z.y).toString()})}}function drawAngle(angle,settings){style=settings.colarrow?settings.color:"#000";_daCanvas.drawArc({strokeStyle:style,x:X_C,y:Y_C,radius:50+_count*2,start:(Math.PI/2-angle),end:Math.PI/2,inDegrees:false});tx=X_C+30*math.cos(angle-Math.PI/6);ty=Y_C-30*math.sin(angle-Math.PI/6);_daCanvas.drawText({strokeStyle:style,strokeWidth:1,x:tx,y:ty,fontSize:12,fontFamily:"serif",text:math.round(angle,2)})}function circ(){if(_daCanvas==null){return}_daCanvas.drawArc({draggable:false,strokeStyle:"#999",strokeWidth:1,x:X_C,y:Y_C,radius:(_radius*_SCALE)})}this.getradius=function(){return _radius};this.ToCartesian=function(){retval=this.zNum.format(3);return retval};this.ToCC=function(){retval=math.conj(this.zNum).format(3);return retval};this.ToR=function(){retval=math.round(this.zNum.toPolar().r,3);return retval};this.ToTrigonometric=function(){rad=math.round(this.zNum.toPolar().r,3);phi=math.round(this.zNum.toPolar().phi,3);retval=rad+"&middot;(cos("+phi+") + i &middot;sin("+phi+"))";return retval};this.ToPolar=function(){rad=math.round(this.zNum.toPolar().r,3);phi=math.round(this.zNum.toPolar().phi,3);retval=rad+"&middot; e<sup>i "+phi+"</sup>";return retval};this.setCanvas=function(cnv){_daCanvas=cnv};this.getXPos=function(x){return _XPos(x)};this.getYPos=function(y){return _YPos(y)};this.multiplyCNum=function(z2,options,resultoptions){resultoptions=(typeof resultoptions=="undefined"?options:resultoptions);res=new CNum(math.multiply(this.zNum,z2.zNum).toString());this.displayGauss(options,getmax(this.getradius(),z2.getradius(),res.getradius()));this.addToPlot(z2,options);this.addToPlot(res,resultoptions);return res};this.addCNum=function(_zToAdd,options,resultoptions){resultoptions=(typeof resultoptions=="undefined"?options:resultoptions);res=new CNum(this.zNum.toString()+"+"+_zToAdd.zNum.toString());this.displayGauss(options,getmax(this.getradius(),_zToAdd.getradius(),res.getradius()));this.addVector(_zToAdd,this.x,this.y,options);this.addToPlot(res,resultoptions);return res};this.addToPlot=function(z,options){var settings=$.extend({},_defaults,options);if(settings.arc){drawAngle(z.angle,settings)}if(settings.ReIm){drawReIm(z.x,z.y,settings.color)}drawz(z,settings,0,0);_count++};this.addVector=function(z,x,y,options){var settings=$.extend({},_defaults,options);if(settings.arc){drawAngle(z.angle,settings)}if(settings.ReIm){drawReIm(z.x,z.y,settings.color)}drawz(z,settings,x,y);_count++};this.displayGauss=function(options,radius){maxR=(typeof radius=="undefined"?_radius:radius);var settings=$.extend({},_defaults,{clear:true,coords:true,circle:true},options);setScale(maxR);if(settings.clear){_daCanvas.clearCanvas();_count=0}if(settings.coords){axis()}if(settings.circle){circ()}this.addToPlot(this,settings)};return this};