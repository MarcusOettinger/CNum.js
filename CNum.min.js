function CNum(t){var e,o,n=50,r=100,s=100,a=10,h=1,u=3,l=null,d=null,f=.001,c={clear:!1,coords:!1,Arrow:!0,arrowAngle:45,arrowRadius:10,circle:!1,ReIm:!0,Ctext:!0,arc:!0,showDegree:!0,decimals:1,fontSize:"12px",fontFamily:"serif",color:"#888",linewidth:1};zStr=math.eval(t),this.zNum=math.complex(zStr),this.x=math.round(this.zNum.re,3),this.y=math.round(this.zNum.im,3),this.offsetx=0,this.offsety=0;var m=this.zNum.toPolar().r,g=this.zNum.toPolar().phi;this.angle=g<0?2*Math.PI+g:g,this._daSettings=c;var v=[];function S(t){return a*t}function w(t){return a*t}function p(t){return r+S(t)}function P(t){return s-w(t)}function N(t){return"number"==typeof t?t?t<0?-1:1:t==t?0:NaN:NaN}function T(t,i){return i<t?i:t}function z(t,i,e){return i?math.round(360*t/(2*Math.PI),e)+"Â°":math.round(t,e)}function _(){for(var t=1;t<arguments.length;t++)for(var i in arguments[t])arguments[t].hasOwnProperty(i)&&(arguments[0][i]=arguments[t][i]);return arguments[0]}function G(t,i,e,o,n,r){var s,a,h,u,l,d,f,c=Math.atan2,x=Math.PI,y=(Math.round,Math.abs,Math.sin),m=Math.cos;i.arrowRadius&&(f=c(r-o,n-e),f-=x,l=i.linewidth*m(f)-1,d=i.linewidth*y(f)-1,s=n-i.arrowRadius*m(f+i.arrowAngle/2),a=r-i.arrowRadius*y(f+i.arrowAngle/2),h=n-i.arrowRadius*m(f-i.arrowAngle/2),u=r-i.arrowRadius*y(f-i.arrowAngle/2),t.moveTo(s-l,a-d),t.lineTo(n-l,r-d),t.lineTo(h-l,u-d),t.closePath(),t.fill(),t.moveTo(n-l,r-d),t.lineTo(n+l,r+d),t.moveTo(n,r))}function C(t,i){if(null!=d){var e=_({},t,i);d.strokeStyle=e.color,d.fillStyle=e.color,d.lineWidth=e.linewidth,d.beginPath(),d.moveTo(e.x1,e.y1),d.lineTo(e.x2,e.y2),e.endArrow&&G(d,e,e.x1,e.y1,e.x2,e.y2),e.startArrow&&G(d,e,e.x2,e.y2,e.x1,e.y1),d.stroke()}}function R(t,i){if(null!=d){var e=_({},t,i);d.beginPath(),d.strokeStyle=e.color,d.lineWidth=e.linewidth,d.fillStyle=e.color,function(t,i){var e,o,n,r=i.fontSize;if(0==(o="px",(n=(e=r).length-o.length)>=0&&e.indexOf(o,n)>-1)){for(;isNaN(r)&&r.length>1;)r=r.substring(0,r.length-1);r+="px"}t.font=r+" "+i.fontFamily}(d,e),d.textAlign="center",d.textBaseline="middle",d.fillText(e.text,e.x,e.y)}}function A(t,i){if(null!=d){var e=_({},t.GetSettings(),i);d.beginPath(),d.strokeStyle=e.color,d.lineWidth=e.linewidth,d.arc(e.x,e.y,e.radius,e.start,-e.end,!0),d.stroke()}}function I(t,i){C(t,{x1:p(i),y1:s,x2:p(i),y2:s+u}),R(t,{x:p(i),y:s+10,text:i}),C(t,{x1:r,y1:P(i),x2:r-u,y2:P(i)}),R(t,{x:r-20,y:P(i)+3,text:i})}function M(t){if(null!=l){var a=d.measureText("Re(z)").width+10;parseInt(d.font.match(/\d+/),10);for(C(t,{endArrow:!0,x1:n,y1:s,x2:e+n,y2:s}),R(t,{x:e+2*n-a/2,y:s,text:"Re(z)"}),R(t,{x:r,y:n/2,text:"Im(z)"}),C(t,{endArrow:!0,x1:r,y1:o+n,x2:r,y2:n}),i=f;i<=h;i+=f)I(t,i)}}function b(t){xpos=p(t.x+t.offsetx),ypos=P(t.y+t.offsety),x=S(t.offsetx),y=w(t.offsety),corr=t.offsetx>0?15:0;var i=t.GetSettings();if(i.Arrow?C(i,{endArrow:!0,x1:r+x,y1:s-y,x2:xpos,y2:ypos}):function(t){if(null!=d){var i=_({},this._daSettings,t);d.beginPath(),d.strokeStyle=i.color,d.lineWidth=i.linewidth,d.rect(i.x,i.y,i.width,i.height),d.stroke()}}({x:xpos-2,y:ypos-2,width:4,height:4}),void 0!==i.Ctext&&!1!==i.Ctext&&null!==i.Ctext){var e="";e="boolean"==typeof i.Ctext&&1==i.Ctext?"z ="+math.complex(t.x,t.y).toString():i.Ctext,R(i,{x:xpos+10+corr,y:ypos-10*N(t.y),text:e})}}return _count=1,this.GetRadius=function(){return m},this.GetSettings=function(){return this._daSettings},this.SetSettings=function(t){var i=this.GetSettings();return this._daSettings=_({},i,t),this._daSettings},this.ToCartesian=function(){var t="undefined"==typeof decimals?this._daSettings.decimals:decimals;return this.zNum.format(t)},this.ToCC=function(t){var i=void 0===t?this._daSettings.decimals:t;return math.conj(this.zNum).format(i)},this.ToR=function(t){var i=void 0===t?this._daSettings.decimals:t;return math.round(this.zNum.toPolar().r,i)},this.ToTrigonometric=function(t){var i=void 0===t?this._daSettings.decimals:t,e=math.round(this.zNum.toPolar().r,i),o=this.zNum.toPolar().phi;return o=z(o,this._daSettings.showDegree,i),retval=e+"&middot;(cos("+o+") + i &middot;sin("+o+"))",retval},this.ToPolar=function(t){var i=void 0===t?this._daSettings.decimals:t,e=math.round(this.zNum.toPolar().r,i),o=this.zNum.toPolar().phi;return o=z(o,this._daSettings.showDegree,i),retval=e+"&middot; e<sup>i "+o+"</sup>",retval},this.setCanvas=function(t){return l=t,d=t?t.getContext("2d"):null,t},this.getXPos=function(t){return p(t)},this.getYPos=function(t){return P(t)},this.multiplyCNum=function(t,i,e){var o=_({},c,i,{circle:!1});return e=void 0===e?o:_({},c,e),res=new CNum(math.multiply(this.zNum,t.zNum).toString()),t.offsetx=0,t.offsety=0,this.addToPlot(t,o),this.addToPlot(res,e),this.displayGauss(this.GetSettings()),res},this.addCNum=function(t,i,e){var o=_({},c,i,{circle:!1,arc:!1,ReIm:!1});return e=void 0===e?o:_({},c,e),res=new CNum(this.zNum.toString()+"+"+t.zNum.toString()),this.addToPlot(res,e),t.offsetx=this.x,t.offsety=this.y,this.addToPlot(t,o),this.displayGauss(this.GetSettings()),res},this._drawToPlot=function(t){var i=t.GetSettings();i.circle&&function(t){var i=Math.PI;null!=l&&A(t,{x:r,y:s,radius:t.GetRadius()*a,start:0,end:2*i})}(t),i.arc&&function(t,i){var e=Math.PI;if(null!=l){var o=T(50,this._radius*a/2);o+=2*_count,A(t,{x:r,y:s,radius:o,start:0,end:i}),tx=r+(o-10)*math.cos(i-e/6),ty=s-(o-10)*math.sin(i-e/6),R(t.GetSettings(),{x:tx,y:ty,text:z(i,t.GetSettings().showDegree,t.GetSettings().decimals)})}}(t,t.angle),i.ReIm&&function(t,i,e){xpos=p(i),ypos=P(e),C(t.GetSettings(),{x1:xpos,y1:s,x2:xpos,y2:ypos}),C(t.GetSettings(),{x1:r,y1:ypos,x2:xpos,y2:ypos})}(t,t.x,t.y),b(t)},this.addToPlot=function(t,i){var e=_({},c,i);t.SetSettings(e),t!==this&&v.push(t),this._drawToPlot(t)},this.displayGauss=function(t,i){var u=_({},c,{clear:!0,coords:!0,circle:!0},t);!function(t){for(r=l.width/2,s=l.height/2,e=l.width-2*n,o=l.height-2*n,a=T(e,o)/(2*t),h=t;t/f>10;)f*=10;f>10&&(f*=2)}(void 0===i?function(){for(var t,i,e=m,o=0;o<v.length;o++)t=e,e=(i=v[o].GetRadius())>t?i:t;return e}():i),null!=d&&(d.clearRect(0,0,l.width,l.height),_count=0),M(u),this.addToPlot(this,u);for(var x=0;x<v.length;x++)this._drawToPlot(v[x])},this}
